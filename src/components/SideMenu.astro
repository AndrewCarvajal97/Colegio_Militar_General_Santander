---
// SideMenu.astro - Menú lateral izquierdo con redes sociales y partners
---

<div id="side-menu" class="side-menu-hover fixed left-0 top-1/2 transform -translate-y-[35%] z-40 hidden lg:flex flex-col gap-3 group">
  <!-- Pestaña visible siempre -->
  <div class="side-menu-tab bg-blue-600 text-white flex items-center justify-center rounded-r-2xl w-5 h-24 cursor-pointer absolute left-0 top-1/2 -translate-y-1/2 z-50 group-hover:hidden">
    <span class="text-xs font-bold rotate-180 writing-mode-vertical">REDES</span>
  </div>
  <!-- Contenedor principal del menú, oculto por defecto y visible en hover -->
  <div class="side-menu-content bg-white shadow-lg rounded-r-2xl py-4 px-2 border-l-4 border-blue-600 opacity-0 pointer-events-none group-hover:opacity-100 group-hover:pointer-events-auto transition-all duration-300 relative">
    <!-- Sección de Redes Sociales -->
    <div class="flex flex-col items-center gap-3 mb-6">
      <h3 class="text-xs font-semibold text-gray-700 writing-mode-vertical transform rotate-180 mb-2">
        SÍGUENOS
      </h3>
      
      <!-- Facebook -->
      <a href="https://www.facebook.com/colmilbuc/" 
         class="social-icon group flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-blue-600 transition-all duration-300 hover:scale-110"
         title="Facebook" target="_blank" rel="noopener">
        <img src={`${import.meta.env.BASE_URL}icon_Facebook.png`} alt="Facebook" class="w-6 h-6 object-contain" />
      </a>
      <!-- Instagram -->
      <a href="https://www.instagram.com/colmilbuc/" 
         class="social-icon group flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-gradient-to-r hover:from-purple-500 hover:to-pink-500 transition-all duration-300 hover:scale-110"
         title="Instagram" target="_blank" rel="noopener">
        <img src={`${import.meta.env.BASE_URL}instagram.png`} alt="Instagram" class="w-6 h-6 object-contain" />
      </a>
      <!-- TikTok -->
      <a href="https://www.tiktok.com/@colmilbuc" 
         class="social-icon group flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-black transition-all duration-300 hover:scale-110"
         title="TikTok" target="_blank" rel="noopener">
        <img src={`${import.meta.env.BASE_URL}tiktok.jpg`} alt="TikTok" class="w-6 h-6 object-contain" />
      </a>
      <!-- WhatsApp -->
      <a href="https://api.whatsapp.com/send?phone=+573017189949&text=Buen%20d%C3%ADa,%20Solicito%20informaci%C3%B3n%20de" 
         target="_blank"
         class="social-icon group flex items-center justify-center w-10 h-10 rounded-full bg-gray-100 hover:bg-green-500 transition-all duration-300 hover:scale-110"
         title="WhatsApp" rel="noopener">
        <img src={`${import.meta.env.BASE_URL}whatsapp.png`} alt="WhatsApp" class="w-6 h-6 object-contain" />
      </a>
    </div>

    <!-- Línea separadora -->
    <div class="w-full h-px bg-gradient-to-r from-transparent via-gray-300 to-transparent mb-6"></div>

    <!-- Sección de Partners -->
    <div class="flex flex-col items-center gap-3">
      <h3 class="text-xs font-semibold text-gray-700 writing-mode-vertical transform rotate-180 mb-2">
        PARTNERS
      </h3>
      
      <!-- Santillana -->
      <a href="https://identity.santillanaconnect.com/login/?client_id=neds_client_compartir_colombia_pro&next=/connect/authorize%3Fresponse_type%3Dcode%26client_id%3Dneds_client_compartir_colombia_pro%26scope%3Dopenid%2Bprofile%2Bemail%2Brole%2Bexternal.info%2Bneds%252Ffull_access%26state%3Dn6TrBQUhIzHXcZXuG2p_Q5fE5LEGmckElu8Po0wXLV4%253D%26redirect_uri%3Dhttps%253A%252F%252Fedi-compartir-co.stn-neds.com%252Fts%252Flogin%252Foauth2%252Fcode%252Fcompartirco%26code_challenge_method%3DS256%26nonce%3DVSFy7vISxNWUwUirYjmCqvVtWGMRwMdeAoUq42C-y2M%26code_challenge%3D82uLGoeomSvqVh-__o4sjtOOzo_2eaQ0QfvZyAHBnD8" 
         class="partner-icon group flex items-center justify-center w-12 h-12 rounded-lg bg-gray-100 hover:bg-red-600 transition-all duration-300 hover:scale-110 border-2 border-transparent hover:border-red-200"
         title="Santillana" target="_blank" rel="noopener">
        <img src={`${import.meta.env.BASE_URL}santillana.png`} alt="Santillana" class="w-8 h-8 object-contain" />
      </a>
      <!-- Compartir -->
      <a href="https://compartircolombia.wixsite.com/compartir" 
         class="partner-icon group flex items-center justify-center w-12 h-12 rounded-lg bg-gray-100 hover:bg-blue-600 transition-all duration-300 hover:scale-110 border-2 border-transparent hover:border-blue-200"
         title="Compartir" target="_blank" rel="noopener">
        <img src={`${import.meta.env.BASE_URL}compartirSantillana.png`} alt="Compartir" class="w-8 h-8 object-contain" />
      </a>
    </div>
  </div>
</div>

<!-- Overlay para móvil -->
<div id="side-menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden lg:hidden transition-opacity duration-300"></div>

<!-- Menú móvil -->
<div id="side-menu-mobile" 
     class="fixed left-0 top-0 h-full w-72 max-w-full bg-white shadow-2xl z-40 transform -translate-x-full transition-transform duration-300 lg:hidden rounded-r-2xl overflow-y-auto">
  <!-- Header del menú móvil -->
  <div class="flex items-center justify-between p-4 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-green-500 rounded-tr-2xl">
    <h2 class="text-white font-semibold">Síguenos</h2>
    <button id="close-side-menu" class="text-white hover:text-gray-200 transition-colors">
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>
  <!-- Contenido del menú móvil -->
  <div class="p-6 pb-16">
    <!-- Redes Sociales en móvil -->
    <div class="mb-8">
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
        <span class="w-2 h-6 bg-gradient-to-b from-blue-600 to-green-500 rounded mr-3"></span>
        Redes Sociales
      </h3>
      <div class="grid grid-cols-2 gap-4">
        <a href="https://www.facebook.com/colmilbuc/" class="mobile-social-item flex items-center p-3 rounded-lg bg-gray-50 hover:bg-blue-50 transition-colors" target="_blank" rel="noopener">
          <img src={`${import.meta.env.BASE_URL}icon_Facebook.png`} alt="Facebook" class="w-8 h-8 object-contain mr-3" />
          <span class="text-sm font-medium text-gray-700">Facebook</span>
        </a>
        <a href="https://www.instagram.com/colmilbuc/" class="mobile-social-item flex items-center p-3 rounded-lg bg-gray-50 hover:bg-pink-50 transition-colors" target="_blank" rel="noopener">
          <img src={`${import.meta.env.BASE_URL}instagram.png`} alt="Instagram" class="w-8 h-8 object-contain mr-3" />
          <span class="text-sm font-medium text-gray-700">Instagram</span>
        </a>
        <a href="https://www.tiktok.com/@colmilbuc" class="mobile-social-item flex items-center p-3 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors" target="_blank" rel="noopener">
          <img src={`${import.meta.env.BASE_URL}tiktok.jpg`} alt="TikTok" class="w-8 h-8 object-contain mr-3" />
          <span class="text-sm font-medium text-gray-700">TikTok</span>
        </a>
        <a href="https://api.whatsapp.com/send?phone=+573017189949&text=Buen%20d%C3%ADa,%20Solicito%20informaci%C3%B3n%20de" target="_blank" rel="noopener" class="mobile-social-item flex items-center p-3 rounded-lg bg-gray-50 hover:bg-green-50 transition-colors">
          <img src={`${import.meta.env.BASE_URL}whatsapp.png`} alt="WhatsApp" class="w-8 h-8 object-contain mr-3" />
          <span class="text-sm font-medium text-gray-700">WhatsApp</span>
        </a>
      </div>
    </div>
    <!-- Partners en móvil -->
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
        <span class="w-2 h-6 bg-gradient-to-b from-red-600 to-blue-600 rounded mr-3"></span>
        Nuestros Partners
      </h3>
      <div class="space-y-3">
        <a href="https://identity.santillanaconnect.com/login/?client_id=neds_client_compartir_colombia_pro&next=/connect/authorize%3Fresponse_type%3Dcode%26client_id%3Dneds_client_compartir_colombia_pro%26scope%3Dopenid%2Bprofile%2Bemail%2Brole%2Bexternal.info%2Bneds%252Ffull_access%26state%3Dn6TrBQUhIzHXcZXuG2p_Q5fE5LEGmckElu8Po0wXLV4%253D%26redirect_uri%3Dhttps%253A%252F%252Fedi-compartir-co.stn-neds.com%252Fts%252Flogin%252Foauth2%252Fcode%252Fcompartirco%26code_challenge_method%3DS256%26nonce%3DVSFy7vISxNWUwUirYjmCqvVtWGMRwMdeAoUq42C-y2M%26code_challenge%3D82uLGoeomSvqVh-__o4sjtOOzo_2eaQ0QfvZyAHBnD8" class="mobile-partner-item flex items-center p-4 rounded-lg bg-gray-50 hover:bg-red-50 transition-colors border-l-4 border-red-600" target="_blank" rel="noopener">
          <img src={`${import.meta.env.BASE_URL}santillana.png`} alt="Santillana" class="w-10 h-10 object-contain mr-4" />
          <div>
            <span class="text-sm font-medium text-gray-800">Santillana</span>
            <p class="text-xs text-gray-500">Editorial educativa</p>
          </div>
        </a>
        <a href="https://compartircolombia.wixsite.com/compartir" class="mobile-partner-item flex items-center p-4 rounded-lg bg-gray-50 hover:bg-blue-50 transition-colors border-l-4 border-blue-600" target="_blank" rel="noopener">
          <img src={`${import.meta.env.BASE_URL}compartirSantillana.png`} alt="Compartir" class="w-10 h-10 object-contain mr-4" />
          <div>
            <span class="text-sm font-medium text-gray-800">Compartir</span>
            <p class="text-xs text-gray-500">Plataforma educativa</p>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Botón toggle para móvil -->
<button id="toggle-side-menu" 
        class="fixed left-2 top-1/2 transform -translate-y-1/2 z-50 lg:hidden bg-white shadow-lg rounded-full p-2 border-2 border-gray-200 hover:border-blue-600 transition-all duration-300">
  <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
  </svg>
</button>

<style>
  /* Texto vertical para desktop */
  .writing-mode-vertical {
    writing-mode: vertical-rl;
    text-orientation: mixed;
  }

  /* Animaciones personalizadas */
  .social-icon:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .partner-icon:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  /* Efectos de hover mejorados */
  .mobile-social-item:hover {
    transform: translateX(5px);
  }

  .mobile-partner-item:hover {
    transform: translateX(5px);
  }

  /* Asegurar que no interfiera con el chatbot */
  #side-menu {
    max-width: 80px;
  }

  /* Responsive adjustments */
  @media (max-width: 1024px) {
    #side-menu {
      display: none;
    }
  }

  /* Estilo para cuando el menú móvil está abierto */
  .side-menu-open {
    transform: translateX(0) !important;
  }

  #side-menu-mobile.side-menu-open {
    transform: translateX(0) !important;
  }
  #side-menu-mobile {
    border-top-right-radius: 1rem;
    border-bottom-right-radius: 1rem;
    box-shadow: 0 8px 32px rgba(31,38,135,0.12);
  }
  #side-menu-overlay {
    transition: opacity 0.3s;
  }
  @media (max-width: 640px) {
    #side-menu-mobile {
      width: 90vw;
      min-width: 0;
      max-width: 100vw;
      padding-bottom: 4rem;
    }
    .p-6 {
      padding: 1.25rem !important;
    }
  }
</style>

<script>
  // Funcionalidad para el menú móvil
  function initSideMenu() {
    const toggleBtn = document.getElementById('toggle-side-menu');
    const closeBtn = document.getElementById('close-side-menu');
    const overlay = document.getElementById('side-menu-overlay');
    const mobileMenu = document.getElementById('side-menu-mobile');

    let isAnimating = false;

    function openMenu() {
      mobileMenu?.classList.add('side-menu-open');
      if (overlay) {
        overlay.classList.remove('hidden');
        overlay.style.opacity = '1';
      }
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      mobileMenu?.classList.remove('side-menu-open');
      if (overlay) {
        overlay.classList.add('hidden');
        overlay.style.opacity = '0';
      }
      document.body.style.overflow = 'auto';
    }

    // Toggle desde el botón flotante (asegura que no se dispare doble si el menú está animando)
    toggleBtn?.addEventListener('click', function() {
      if (!mobileMenu || !overlay || isAnimating) return;
      isAnimating = true;
      if (mobileMenu.classList.contains('side-menu-open')) {
        mobileMenu.classList.remove('side-menu-open');
        overlay.classList.add('hidden');
        overlay.style.opacity = '0';
        document.body.style.overflow = 'auto';
        setTimeout(() => { isAnimating = false; }, 350);
      } else {
        mobileMenu.classList.add('side-menu-open');
        overlay.classList.remove('hidden');
        overlay.style.opacity = '1';
        document.body.style.overflow = 'hidden';
        setTimeout(() => { isAnimating = false; }, 350);
      }
    });

    closeBtn?.addEventListener('click', closeMenu);
    overlay?.addEventListener('click', closeMenu);

    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMenu();
      }
    });

    // Analytics para redes sociales (opcional)
    document.querySelectorAll('.social-icon, .mobile-social-item').forEach(link => {
      link.addEventListener('click', (e) => {
        const el = e.currentTarget as HTMLElement | null;
        const platform = el?.getAttribute('title') || 'Social';
        console.log(`Usuario hizo clic en: ${platform}`);
        
        // Aquí puedes agregar tracking de Google Analytics si lo deseas
        // gtag('event', 'social_click', { platform: platform });
      });
    });

    // Analytics para partners (opcional)
    document.querySelectorAll('.partner-icon, .mobile-partner-item').forEach(link => {
      link.addEventListener('click', (e) => {
        const el = e.currentTarget as HTMLElement | null;
        const partner = el?.getAttribute('title') || 'Partner';
        console.log(`Usuario hizo clic en partner: ${partner}`);
        
        // gtag('event', 'partner_click', { partner: partner });
      });
    });
  }

  // Inicializar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSideMenu);
  } else {
    initSideMenu();
  }
</script>
