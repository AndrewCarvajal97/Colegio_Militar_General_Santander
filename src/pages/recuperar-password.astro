---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
---

<Layout title="Recuperar Contraseña - Colegio Militar General Santander">
  <Header />
  
  <!-- Password Recovery Section -->
  <section class="min-h-screen flex items-center justify-center py-20 px-4" style="background: linear-gradient(135deg, #5771FE 0%, rgb(52, 183, 13) 50%, #5771FE 100%);">
    <div class="absolute inset-0 bg-black/20"></div>
    
    <div class="relative z-10 w-full max-w-lg">
      <!-- Logo y título -->
      <div class="text-center mb-8">
        <div class="w-20 h-20 mx-auto mb-6 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center border-4 border-white/30">
          <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 8A6 6 0 006 8v1H3a1 1 0 00-1 1v8a1 1 0 001 1h14a1 1 0 001-1v-8a1 1 0 00-1-1h-3V8zM8 8a4 4 0 118 0v1H8V8z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <h1 class="text-3xl font-bold text-white mb-2 font-playfair">Recuperar Contraseña</h1>
        <p class="text-white/80 text-lg">Colegio Militar General Santander</p>
        <p class="text-white/60 text-sm mt-1">Restablece tu acceso al portal académico</p>
      </div>

      <!-- Contenedor principal -->
      <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl p-8 border border-white/20">
        
        <!-- Paso 1: Seleccionar método de recuperación -->
        <div id="step-1" class="recovery-step">
          <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-white mb-2">¿Cómo quieres recuperar tu contraseña?</h2>
            <p class="text-white/80 text-sm">Selecciona el método que prefieras</p>
          </div>

          <div class="space-y-4">
            <!-- Opción 1: Por email -->
            <button class="recovery-method w-full p-4 bg-white/10 border border-white/30 rounded-lg text-left hover:bg-white/20 transition-all duration-300" data-method="email">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <h3 class="text-white font-semibold">Por Correo Electrónico</h3>
                  <p class="text-white/70 text-sm">Te enviaremos un enlace de recuperación a tu email</p>
                </div>
                <svg class="w-5 h-5 text-white/60" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </button>

            <!-- Opción 2: Por teléfono -->
            <button class="recovery-method w-full p-4 bg-white/10 border border-white/30 rounded-lg text-left hover:bg-white/20 transition-all duration-300" data-method="phone">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <h3 class="text-white font-semibold">Por Mensaje de Texto</h3>
                  <p class="text-white/70 text-sm">Recibirás un código SMS en tu teléfono registrado</p>
                </div>
                <svg class="w-5 h-5 text-white/60" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </button>

            <!-- Opción 3: Contactar institución -->
            <button class="recovery-method w-full p-4 bg-white/10 border border-white/30 rounded-lg text-left hover:bg-white/20 transition-all duration-300" data-method="contact">
              <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-2 0c0 .993-.241 1.929-.668 2.754l-1.524-1.525a3.997 3.997 0 00.078-2.183l1.562-1.562C15.802 8.249 16 9.1 16 10zm-5.165 3.913l1.58 1.58A5.98 5.98 0 0110 16a5.976 5.976 0 01-2.516-.552l1.562-1.562a4.006 4.006 0 001.789.027zm-4.677-2.796a4.002 4.002 0 01-.041-2.08l-1.56-1.56A5.98 5.98 0 004 10c0 .954.223 1.856.619 2.657l1.539-1.54zm9.589-2.158l1.56-1.56A5.98 5.98 0 0014 4.382v1.618a3.996 3.996 0 00-2.531 2.957l1.278 1.278zm-7.973 2.973l-1.278-1.278a3.996 3.996 0 00-2.957 2.531H5.618A5.98 5.98 0 014.382 14l1.56-1.56zm2.226-4.123a4 4 0 012.002 0L10 6.83 8.998 7.809z" clip-rule="evenodd"></path>
                  </svg>
                </div>
                <div class="flex-1">
                  <h3 class="text-white font-semibold">Contactar la Institución</h3>
                  <p class="text-white/70 text-sm">Solicita ayuda directa del personal autorizado</p>
                </div>
                <svg class="w-5 h-5 text-white/60" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </button>
          </div>
        </div>

        <!-- Paso 2: Formulario por email -->
        <div id="step-2-email" class="recovery-step hidden">
          <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-white mb-2">Recuperación por Email</h2>
            <p class="text-white/80 text-sm">Ingresa tu información para recibir el enlace de recuperación</p>
          </div>

          <form id="email-recovery-form" class="space-y-6">
            <div>
              <label class="block text-white font-medium mb-2">Número de Documento</label>
              <input 
                type="text" 
                id="email-document"
                class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 text-white placeholder-white/60" 
                placeholder="Ingresa tu número de documento"
                required
              >
            </div>

            <div>
              <label class="block text-white font-medium mb-2">Correo Electrónico</label>
              <input 
                type="email" 
                id="email-address"
                class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 text-white placeholder-white/60" 
                placeholder="correo@ejemplo.com"
                required
              >
            </div>

            <div class="flex space-x-3">
              <button type="button" id="back-to-methods" class="flex-1 py-3 px-4 border border-white/30 text-white rounded-lg hover:bg-white/10 transition-colors">
                Volver
              </button>
              <button type="submit" class="flex-1 py-3 px-4 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-colors font-semibold">
                Enviar Enlace
              </button>
            </div>
          </form>
        </div>

        <!-- Paso 2: Formulario por teléfono -->
        <div id="step-2-phone" class="recovery-step hidden">
          <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-white mb-2">Recuperación por SMS</h2>
            <p class="text-white/80 text-sm">Te enviaremos un código de verificación</p>
          </div>

          <form id="phone-recovery-form" class="space-y-6">
            <div>
              <label class="block text-white font-medium mb-2">Número de Documento</label>
              <input 
                type="text" 
                id="phone-document"
                class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 text-white placeholder-white/60" 
                placeholder="Ingresa tu número de documento"
                required
              >
            </div>

            <div>
              <label class="block text-white font-medium mb-2">Número de Teléfono</label>
              <input 
                type="tel" 
                id="phone-number"
                class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-white/50 focus:border-white/50 text-white placeholder-white/60" 
                placeholder="+57 300 123 4567"
                required
              >
            </div>

            <div class="flex space-x-3">
              <button type="button" id="back-to-methods-2" class="flex-1 py-3 px-4 border border-white/30 text-white rounded-lg hover:bg-white/10 transition-colors">
                Volver
              </button>
              <button type="submit" class="flex-1 py-3 px-4 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-colors font-semibold">
                Enviar Código
              </button>
            </div>
          </form>
        </div>

        <!-- Paso 2: Contactar institución -->
        <div id="step-2-contact" class="recovery-step hidden">
          <div class="text-center mb-6">
            <h2 class="text-xl font-bold text-white mb-2">Contactar la Institución</h2>
            <p class="text-white/80 text-sm">Opciones para obtener ayuda directa</p>
          </div>

          <div class="space-y-4">
            <!-- Información de contacto -->
            <div class="bg-white/10 rounded-lg p-4 border border-white/20">
              <h3 class="text-white font-semibold mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                </svg>
                Teléfonos
              </h3>
              <div class="text-white/80 space-y-1">
                <p>(607) 7008460 Ext - 2006</p>
                <p>+57 301 718 9949</p>
                <p class="text-sm text-white/60">Lunes a Viernes: 7:00 AM - 5:30 PM</p>
              </div>
            </div>

            <div class="bg-white/10 rounded-lg p-4 border border-white/20">
              <h3 class="text-white font-semibold mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
                  <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
                </svg>
                Email
              </h3>
              <p class="text-white/80">secretaria@colmil.com.co</p>
            </div>

            <div class="bg-white/10 rounded-lg p-4 border border-white/20">
              <h3 class="text-white font-semibold mb-3 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
                </svg>
                Ubicación
              </h3>
              <p class="text-white/80">Diagonal 32 #30a-05, Salida a Pamplona, Bucaramanga</p>
            </div>

            <div class="flex space-x-3 mt-6">
              <button type="button" id="back-to-methods-3" class="flex-1 py-3 px-4 border border-white/30 text-white rounded-lg hover:bg-white/10 transition-colors">
                Volver
              </button>
              <a href="/contactar-institucion" class="flex-1 py-3 px-4 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-colors font-semibold text-center">
                Formulario de Contacto
              </a>
            </div>
          </div>
        </div>

        <!-- Mensaje de éxito -->
        <div id="success-message" class="recovery-step hidden text-center">
          <div class="w-16 h-16 mx-auto mb-4 bg-green-500/20 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-green-300" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <h2 class="text-xl font-bold text-white mb-2">¡Solicitud Enviada!</h2>
          <p class="text-white/80 text-sm mb-6" id="success-text">
            Hemos enviado las instrucciones a tu correo electrónico.
          </p>
          <a href="/login" class="inline-block py-3 px-6 bg-white/20 text-white rounded-lg hover:bg-white/30 transition-colors font-semibold">
            Volver al Login
          </a>
        </div>
      </div>

      <!-- Enlaces rápidos -->
      <div class="mt-6 text-center text-white/60 text-sm space-y-2">
        <p>
          <a href="/login" class="hover:text-white underline">← Volver al inicio de sesión</a>
        </p>
        <p>
          ¿Necesitas una cuenta nueva? 
          <a href="/contactar-institucion" class="hover:text-white underline">Contacta la institución</a>
        </p>
      </div>
    </div>
  </section>

  <Footer />
</Layout>

<style>
  .recovery-step {
    transition: all 0.3s ease-in-out;
  }
  
  .recovery-method:hover {
    transform: translateX(5px);
  }
  
  input:focus {
    background-color: rgba(255, 255, 255, 0.15) !important;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Elementos de los pasos
    const step1 = document.getElementById('step-1');
    const step2Email = document.getElementById('step-2-email');
    const step2Phone = document.getElementById('step-2-phone');
    const step2Contact = document.getElementById('step-2-contact');
    const successMessage = document.getElementById('success-message');
    
    // Botones de métodos
    const recoveryMethods = document.querySelectorAll('.recovery-method');
    
    // Botones de volver
    const backButtons = document.querySelectorAll('[id^="back-to-methods"]');
    
    // Manejar selección de método
    recoveryMethods.forEach(method => {
      method.addEventListener('click', function() {
        const methodType = this.dataset.method;
        
        // Ocultar paso 1
        step1.classList.add('hidden');
        
        // Mostrar paso correspondiente
        if (methodType === 'email') {
          step2Email.classList.remove('hidden');
        } else if (methodType === 'phone') {
          step2Phone.classList.remove('hidden');
        } else if (methodType === 'contact') {
          step2Contact.classList.remove('hidden');
        }
      });
    });
    
    // Botones de volver
    backButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        // Ocultar todos los pasos
        document.querySelectorAll('.recovery-step').forEach(step => {
          step.classList.add('hidden');
        });
        
        // Mostrar paso 1
        step1.classList.remove('hidden');
      });
    });
    
    // Formulario de recuperación por email
    document.getElementById('email-recovery-form')?.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const document_num = document.getElementById('email-document').value;
      const email = document.getElementById('email-address').value;
      
      if (document_num && email) {
        // Simular envío
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Enviando...';
        submitBtn.disabled = true;
        
        setTimeout(() => {
          // Ocultar formulario y mostrar éxito
          step2Email.classList.add('hidden');
          successMessage.classList.remove('hidden');
          
          document.getElementById('success-text').textContent = 
            `Hemos enviado un enlace de recuperación a ${email}. Revisa tu bandeja de entrada y spam.`;
          
          submitBtn.textContent = 'Enviar Enlace';
          submitBtn.disabled = false;
        }, 2000);
      }
    });
    
    // Formulario de recuperación por teléfono
    document.getElementById('phone-recovery-form')?.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const document_num = document.getElementById('phone-document').value;
      const phone = document.getElementById('phone-number').value;
      
      if (document_num && phone) {
        // Simular envío
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.textContent = 'Enviando...';
        submitBtn.disabled = true;
        
        setTimeout(() => {
          // Ocultar formulario y mostrar éxito
          step2Phone.classList.add('hidden');
          successMessage.classList.remove('hidden');
          
          document.getElementById('success-text').textContent = 
            `Hemos enviado un código de verificación al número ${phone}. El código llegará en los próximos minutos.`;
          
          submitBtn.textContent = 'Enviar Código';
          submitBtn.disabled = false;
        }, 2000);
      }
    });
  });
</script>
